<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BidEasy - Real-Time Auction System</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .tabs {
        display: flex;
        background-color: #f1f1f1;
        border-bottom: 1px solid #ccc;
        margin-bottom: 20px;
      }

      .tab {
        background-color: inherit;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 16px;
      }

      .tab:hover {
        background-color: #ddd;
      }

      .tab.active {
        background-color: #28a745;
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .user-info {
        background: #e9ecef;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
      }

      .auction {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .auction.ended {
        background: #f8f9fa;
        border-left: 5px solid #dc3545;
      }

      .auction-header {
        font-size: 18px;
        font-weight: bold;
        color: #28a745;
        margin-bottom: 10px;
      }

      .auction-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
      }

      .bid-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
      }

      .bid-button:hover {
        background: #0056b3;
      }

      .status-online {
        color: #28a745;
        font-weight: bold;
      }

      .status-offline {
        color: #dc3545;
        font-weight: bold;
      }

      .quick-bid {
        display: inline-block;
        margin: 5px;
      }

      /* Modern Toast Notification System */
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 12px;
        max-width: 400px;
        pointer-events: none;
      }

      .notification {
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
        padding: 16px 20px;
        display: flex;
        align-items: flex-start;
        gap: 12px;
        min-width: 320px;
        max-width: 400px;
        opacity: 0;
        transform: translateX(400px);
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        pointer-events: all;
        border-left: 4px solid;
        position: relative;
        overflow: hidden;
      }

      .notification.show {
        opacity: 1;
        transform: translateX(0);
      }

      .notification.hide {
        opacity: 0;
        transform: translateX(450px) scale(0.8);
        max-height: 0;
        padding: 0 20px;
        margin-bottom: -12px;
      }

      .notification-icon {
        font-size: 24px;
        flex-shrink: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .notification-content {
        flex: 1;
        padding-top: 2px;
      }

      .notification-title {
        font-weight: 600;
        font-size: 15px;
        margin-bottom: 4px;
        color: #1a202c;
      }

      .notification-message {
        font-size: 14px;
        color: #4a5568;
        line-height: 1.4;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        color: #718096;
        transition: all 0.2s;
        margin: 0;
        flex-shrink: 0;
      }

      .notification-close:hover {
        background: rgba(0, 0, 0, 0.05);
        color: #2d3748;
        transform: none;
        box-shadow: none;
      }

      .notification-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background: currentColor;
        opacity: 0.3;
        transition: width linear;
      }

      /* Success Notification */
      .notification.success {
        border-left-color: #10b981;
      }

      .notification.success .notification-icon {
        background: #d1fae5;
        color: #10b981;
      }

      .notification.success .notification-progress {
        color: #10b981;
      }

      /* Error Notification */
      .notification.error {
        border-left-color: #ef4444;
      }

      .notification.error .notification-icon {
        background: #fee2e2;
        color: #ef4444;
      }

      .notification.error .notification-progress {
        color: #ef4444;
      }

      /* Info Notification */
      .notification.info {
        border-left-color: #3b82f6;
      }

      .notification.info .notification-icon {
        background: #dbeafe;
        color: #3b82f6;
      }

      .notification.info .notification-progress {
        color: #3b82f6;
      }

      /* Warning Notification */
      .notification.warning {
        border-left-color: #f59e0b;
      }

      .notification.warning .notification-icon {
        background: #fef3c7;
        color: #f59e0b;
      }

      .notification.warning .notification-progress {
        color: #f59e0b;
      }

      /* Bid Notification (Special) */
      .notification.bid {
        border-left-color: #8b5cf6;
      }

      .notification.bid .notification-icon {
        background: #ede9fe;
        color: #8b5cf6;
      }

      .notification.bid .notification-progress {
        color: #8b5cf6;
      }
    </style>
  </head>
  <body>
    <div id="login" style="display: block">
      <h1>&#127919; BidEasy - Real-Time Auction System</h1>
      <form id="loginForm">
        <h2>Welcome! Please Login</h2>
        <input
          type="text"
          id="username"
          placeholder="Enter your username"
          required
        />
        <button type="submit">Join Auction House</button>
      </form>
    </div>

    <div id="main" style="display: none">
      <div class="user-info">
        <h1>&#127919; BidEasy Dashboard</h1>
        <p>
          Welcome, <strong id="currentUser"></strong>! | Status:
          <span id="connectionStatus" class="status-offline">Offline</span>
        </p>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="openTab(event, 'auctionList')">
          &#127942; Active Auctions
        </button>
        <button class="tab" onclick="openTab(event, 'createAuction')">
          &#10133; Create Auction
        </button>
        <button class="tab" onclick="openTab(event, 'placeBid')">
          &#128176; Place Bid
        </button>
        <button class="tab" onclick="openTab(event, 'myActivity')">
          &#128202; My Activity
        </button>
      </div>

      <div id="auctionList" class="tab-content active">
        <h2>Active Auctions</h2>
        <div id="auctions">
          <p>No active auctions. Be the first to create one!</p>
        </div>
      </div>

      <div id="createAuction" class="tab-content">
        <h2>Create New Auction</h2>
        <form id="createForm">
          <label
            >Auction Name:
            <input
              type="text"
              id="name"
              placeholder="e.g., iPhone 15 Pro"
              required /></label
          ><br />
          <label
            >Starting Price ($):
            <input
              type="number"
              id="price"
              step="0.01"
              min="0.01"
              placeholder="0.01"
              required /></label
          ><br />
          <label
            >Duration (seconds):
            <input
              type="number"
              id="duration"
              min="10"
              placeholder="60"
              required /></label
          ><br />
          <button type="submit">&#128640; Create Auction</button>
        </form>
        <div id="createMessage"></div>
      </div>

      <div id="placeBid" class="tab-content">
        <h2>Place Bid</h2>
        <form id="bidForm">
          <label
            >Auction ID:
            <input type="number" id="bidAuctionId" min="0" required /></label
          ><br />
          <label
            >Your Bid ($):
            <input
              type="number"
              id="bidAmount"
              step="0.01"
              min="0.01"
              required /></label
          ><br />
          <button type="submit">&#128176; Place Bid</button>
        </form>
        <div id="bidMessage"></div>
      </div>

      <div id="myActivity" class="tab-content">
        <h2>My Activity</h2>
        <div id="activityLog">
          <p>Your auction activity will appear here...</p>
        </div>
      </div>
    </div>

    <!-- Modern Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <script>
      let ws;
      let username;
      let myAuctions = [];
      let myBids = [];

      // Login functionality
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          login();
        });

      function login() {
        username = document.getElementById("username").value.trim();
        if (!username) {
          showError("Please enter a valid username to continue", "Login Required");
          return;
        }

        try {
          ws = new WebSocket("ws://localhost:5001");

          ws.onopen = () => {
            ws.send("LOGIN|" + username);
            document.getElementById("connectionStatus").textContent =
              "Connecting...";
            showInfo("Connecting to auction server...", "Establishing Connection");
          };

          ws.onmessage = handleMessage;

          ws.onclose = () => {
            document.getElementById("connectionStatus").textContent = "Offline";
            document.getElementById("connectionStatus").className =
              "status-offline";
            showError(
              "Connection lost. Please refresh and try again.",
              "Disconnected"
            );
          };

          ws.onerror = (error) => {
            showError(
              "Connection error. Make sure the server is running.",
              "Connection Failed"
            );
          };
        } catch (error) {
          showError(
            "Failed to connect. Make sure the server is running on localhost:5001",
            "Connection Failed"
          );
        }
      }

      function handleMessage(event) {
        const msg = event.data;
        console.log("Received:", msg);

        if (msg.startsWith("WELCOME|")) {
          document.getElementById("login").style.display = "none";
          document.getElementById("main").style.display = "block";
          document.getElementById("currentUser").textContent = username;
          document.getElementById("connectionStatus").textContent = "Online";
          document.getElementById("connectionStatus").className =
            "status-online";
          showSuccess(`Welcome to BidEasy, ${username}! ðŸŽ‰`, "Connected Successfully");
        } else if (msg.startsWith("NEW_AUCTION|")) {
          const parts = msg.split("|");
          addAuction(parts[1], parts[2], parts[3], parts[4]);
        } else if (msg.startsWith("UPDATE|")) {
          const parts = msg.split("|");
          updateAuction(parts[1], parts[2], parts[3]);
        } else if (msg.startsWith("END|")) {
          const parts = msg.split("|");
          endAuction(parts[1], parts[2], parts[3]);
        } else if (msg.startsWith("ERROR|")) {
          const errorMsg = msg.split("|")[1];
          showError(errorMsg, "Server Error");
        } else {
          console.log("Unknown message:", msg);
        }
      }

      // Tab functionality
      function openTab(evt, tabName) {
        var i, tabcontent, tabs;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].classList.remove("active");
        }
        tabs = document.getElementsByClassName("tab");
        for (i = 0; i < tabs.length; i++) {
          tabs[i].classList.remove("active");
        }
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
      }

      // Auction management
      function addAuction(id, name, price, duration) {
        const auctionsDiv = document.getElementById("auctions");
        if (auctionsDiv.innerHTML.includes("No active auctions")) {
          auctionsDiv.innerHTML = "";
        }

        const div = document.createElement("div");
        div.id = "auction-" + id;
        div.className = "auction";
        div.innerHTML = `
          <div class="auction-header">${name}</div>
          <div class="auction-details">
            <div><strong>ID:</strong> ${id}</div>
            <div><strong>Starting Price:</strong> $${price}</div>
            <div><strong>Current Bid:</strong> $${price}</div>
            <div><strong>Highest Bidder:</strong> None yet</div>
            <div><strong>Time Left:</strong> <span id="timer-${id}">${duration}s</span></div>
            <div><strong>Status:</strong> <span style="color: #28a745;">Active</span></div>
          </div>
          <div class="quick-bid">
            <button class="bid-button" onclick="quickBid(${id}, ${
          parseFloat(price) + 1
        })">Quick Bid $${parseFloat(price) + 1}</button>
            <button class="bid-button" onclick="quickBid(${id}, ${
          parseFloat(price) + 5
        })">Quick Bid $${parseFloat(price) + 5}</button>
          </div>
        `;
        auctionsDiv.appendChild(div);

        // Start countdown timer
        startTimer(id, parseInt(duration));

        showInfo(`${name} - Starting at $${price}`, "ðŸ”¨ New Auction Available");
      }

      function updateAuction(id, bid, bidder) {
        const div = document.getElementById("auction-" + id);
        if (div) {
          const currentBidElement = div.querySelector(
            ".auction-details div:nth-child(3)"
          );
          const bidderElement = div.querySelector(
            ".auction-details div:nth-child(4)"
          );
          const quickBidButtons = div.querySelectorAll(".bid-button");

          if (currentBidElement)
            currentBidElement.innerHTML = `<strong>Current Bid:</strong> $${bid}`;
          if (bidderElement)
            bidderElement.innerHTML = `<strong>Highest Bidder:</strong> ${bidder}`;

          // Update quick bid buttons
          quickBidButtons.forEach((button, index) => {
            const increment = index === 0 ? 1 : 5;
            const newBid = parseFloat(bid) + increment;
            button.textContent = `Quick Bid $${newBid}`;
            button.onclick = () => quickBid(id, newBid);
          });

          if (bidder === username) {
            showBidNotification(
              `You are leading with $${bid} on auction #${id}!`,
              "ðŸŽ¯ You're Winning!"
            );
          } else {
            showBidNotification(
              `$${bid} by ${bidder}`,
              `ðŸ’° Auction #${id} Updated`
            );
          }
        }
      }

      function endAuction(id, winner, price) {
        const div = document.getElementById("auction-" + id);
        if (div) {
          div.className = "auction ended";
          const statusElement = div.querySelector(
            ".auction-details div:nth-child(6)"
          );
          if (statusElement)
            statusElement.innerHTML = `<strong>Status:</strong> <span style="color: #dc3545;">Ended</span>`;

          // Remove quick bid buttons
          const quickBidDiv = div.querySelector(".quick-bid");
          if (quickBidDiv)
            quickBidDiv.innerHTML = `<p><strong>&#127942; Winner:</strong> ${winner} | <strong>Final Price:</strong> $${price}</p>`;

          if (winner === username) {
            showSuccess(
              `You won with a final bid of $${price}! ðŸŽŠ`,
              `ðŸ† Auction #${id} Won!`
            );
          } else if (winner === "None") {
            showInfo(
              `No bids were placed.`,
              `Auction #${id} Ended`
            );
          } else {
            showInfo(
              `Winner: ${winner} with $${price}`,
              `Auction #${id} Ended`
            );
          }
        }
      }

      function startTimer(auctionId, duration) {
        let timeLeft = duration;
        const timerElement = document.getElementById(`timer-${auctionId}`);
        let warningShown = false;

        const interval = setInterval(() => {
          timeLeft--;
          if (timerElement) {
            timerElement.textContent = timeLeft + "s";
            if (timeLeft <= 10) {
              timerElement.style.color = "#dc3545";
              timerElement.style.fontWeight = "bold";
              
              // Show warning at 10 seconds
              if (timeLeft === 10 && !warningShown) {
                const auctionDiv = document.getElementById(`auction-${auctionId}`);
                const auctionName = auctionDiv?.querySelector('.auction-header')?.textContent || `#${auctionId}`;
                showWarning(
                  `Only 10 seconds left to bid!`,
                  `â° ${auctionName} Ending Soon`
                );
                warningShown = true;
              }
            }
          }
          if (timeLeft <= 0) {
            clearInterval(interval);
          }
        }, 1000);
      }

      function quickBid(auctionId, amount) {
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(`BID|${auctionId}|${amount}|${username}`);
          myBids.push({ id: auctionId, amount });
          updateMyActivity();
          showBidNotification(
            `Quick bid of $${amount} placed successfully!`,
            `âš¡ Auction #${auctionId}`
          );
        } else {
          showError(
            "Connection lost. Please refresh the page.",
            "Not Connected"
          );
        }
      }

      // Create auction form
      document
        .getElementById("createForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("name").value.trim();
          const price = document.getElementById("price").value;
          const duration = document.getElementById("duration").value;

          if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(`CREATE|${name}|${price}|${duration}`);
            document.getElementById("createMessage").innerHTML =
              '<p style="color: #28a745;">Auction created successfully!</p>';
            document.getElementById("createForm").reset();
            myAuctions.push({ name, price, duration });
            updateMyActivity();
            showSuccess(
              `"${name}" created with starting price $${price}`,
              "Auction Created!"
            );
          } else {
            showError(
              "Connection lost. Please refresh the page.",
              "Not Connected"
            );
          }
        });

      // Bid form
      document
        .getElementById("bidForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const id = document.getElementById("bidAuctionId").value;
          const amount = document.getElementById("bidAmount").value;

          if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(`BID|${id}|${amount}|${username}`);
            document.getElementById("bidMessage").innerHTML =
              '<p style="color: #28a745;">Bid submitted!</p>';
            myBids.push({ id, amount });
            updateMyActivity();
            showBidNotification(
              `Placed $${amount} on auction #${id}`,
              "Bid Submitted!"
            );
          } else {
            showError(
              "Connection lost. Please refresh the page.",
              "Not Connected"
            );
          }
        });

      function updateMyActivity() {
        const activityLog = document.getElementById("activityLog");
        let html = "<h3>My Auctions Created:</h3>";
        if (myAuctions.length === 0) {
          html += "<p>You haven't created any auctions yet.</p>";
        } else {
          myAuctions.forEach((auction, index) => {
            html += `<p>&#128221; ${auction.name} - Starting at $${auction.price} for ${auction.duration}s</p>`;
          });
        }

        html += "<h3>My Bids:</h3>";
        if (myBids.length === 0) {
          html += "<p>You haven't placed any bids yet.</p>";
        } else {
          myBids.forEach((bid, index) => {
            html += `<p>&#128176; Bid $${bid.amount} on auction #${bid.id}</p>`;
          });
        }

        activityLog.innerHTML = html;
      }

      // Modern Interactive Notification System
      let notificationId = 0;

      function showNotification(message, type = "info", title = null, duration = 4000) {
        const container = document.getElementById("notification-container");
        const id = ++notificationId;

        // Auto-generate title if not provided
        if (!title) {
          const titles = {
            success: "Success!",
            error: "Error!",
            info: "Info",
            warning: "Warning!",
            bid: "New Bid!"
          };
          title = titles[type] || "Notification";
        }

        // Icons for different types
        const icons = {
          success: "âœ“",
          error: "âœ•",
          info: "â“˜",
          warning: "âš ",
          bid: "ðŸ”¨"
        };

        // Create notification element
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.setAttribute("data-id", id);
        notification.innerHTML = `
          <div class="notification-icon">${icons[type] || "â“˜"}</div>
          <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
          </div>
          <button class="notification-close" onclick="dismissNotification(${id})" aria-label="Close">Ã—</button>
          <div class="notification-progress" style="width: 100%"></div>
        `;

        container.appendChild(notification);

        // Trigger show animation
        setTimeout(() => {
          notification.classList.add("show");
        }, 10);

        // Progress bar animation
        const progressBar = notification.querySelector(".notification-progress");
        setTimeout(() => {
          progressBar.style.width = "0%";
          progressBar.style.transition = `width ${duration}ms linear`;
        }, 50);

        // Auto dismiss
        const timeoutId = setTimeout(() => {
          dismissNotification(id);
        }, duration);

        // Store timeout ID for manual dismissal
        notification.setAttribute("data-timeout", timeoutId);

        // Limit to 5 notifications
        const notifications = container.querySelectorAll(".notification");
        if (notifications.length > 5) {
          dismissNotification(notifications[0].getAttribute("data-id"));
        }
      }

      function dismissNotification(id) {
        const notification = document.querySelector(`[data-id="${id}"]`);
        if (!notification) return;

        // Clear auto-dismiss timeout
        const timeoutId = notification.getAttribute("data-timeout");
        if (timeoutId) clearTimeout(timeoutId);

        // Hide animation
        notification.classList.remove("show");
        notification.classList.add("hide");

        // Remove from DOM after animation
        setTimeout(() => {
          notification.remove();
        }, 400);
      }

      // Enhanced notification helpers
      function showSuccess(message, title = "Success!") {
        showNotification(message, "success", title);
      }

      function showError(message, title = "Error!") {
        showNotification(message, "error", title);
      }

      function showInfo(message, title = "Info") {
        showNotification(message, "info", title);
      }

      function showWarning(message, title = "Warning!") {
        showNotification(message, "warning", title);
      }

      function showBidNotification(message, title = "New Bid!") {
        showNotification(message, "bid", title);
      }

      // Initialize activity log
      updateMyActivity();
    </script>
  </body>
</html> -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BidEasy - Enterprise Auction Platform</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0c29 0%,
          #302b63 50%,
          #24243e 100%
        );
        min-height: 100vh;
        color: #e4e6eb;
        line-height: 1.6;
      }

      /* Login Page */
      #login {
        max-width: 480px;
        margin: 80px auto;
        background: #1e1e2e;
        padding: 50px 40px;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid #2d2d44;
      }

      .login-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .logo-container {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      }

      .logo-container i {
        font-size: 40px;
        color: white;
      }

      .login-header h1 {
        color: #e4e6eb;
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .login-header p {
        color: #b0b3b8;
        font-size: 15px;
      }

      /* Main Dashboard */
      #main {
        max-width: 1600px;
        margin: 20px auto;
        background: #1a1a2e;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid #2d2d44;
      }

      /* Header */
      .dashboard-header {
        background: #16213e;
        padding: 24px 32px;
        border-bottom: 1px solid #2d2d44;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .header-logo {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-logo i {
        font-size: 24px;
        color: white;
      }

      .header-title h1 {
        font-size: 24px;
        font-weight: 700;
        color: #e4e6eb;
        margin-bottom: 2px;
      }

      .header-title p {
        font-size: 13px;
        color: #b0b3b8;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 16px;
        background: #1e1e2e;
        padding: 12px 20px;
        border-radius: 12px;
        border: 1px solid #2d2d44;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      .user-details strong {
        display: block;
        font-size: 14px;
        color: #e4e6eb;
      }

      .connection-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        margin-top: 2px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
      }

      .status-online .status-dot {
        background: #28a745;
        box-shadow: 0 0 8px rgba(40, 167, 69, 0.5);
        animation: pulse-online 2s infinite;
      }

      .status-offline .status-dot {
        background: #dc3545;
      }

      @keyframes pulse-online {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Tabs */
      .tabs {
        display: flex;
        background: #16213e;
        border-bottom: 2px solid #2d2d44;
        padding: 0 32px;
        overflow-x: auto;
      }

      .tab {
        background: none;
        border: none;
        padding: 16px 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #b0b3b8;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
      }

      .tab:hover {
        color: #e4e6eb;
        background: #1e1e2e;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab i {
        font-size: 16px;
      }

      /* Content Area */
      .tab-content {
        display: none;
        padding: 32px;
        background: #0f0f1e;
      }

      .tab-content.active {
        display: block;
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .content-header h2 {
        font-size: 22px;
        font-weight: 700;
        color: #e4e6eb;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Forms */
      form {
        background: #1e1e2e;
        padding: 32px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        border: 1px solid #2d2d44;
      }

      .form-group {
        margin-bottom: 24px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #b0b3b8;
        font-size: 14px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #2d2d44;
        border-radius: 8px;
        font-size: 15px;
        transition: all 0.3s;
        font-family: inherit;
        background: #16213e;
        color: #e4e6eb;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        background: #1e1e2e;
      }

      button[type="submit"],
      .action-button {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      button[type="submit"]:hover,
      .action-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      /* Auctions Grid */
      .auctions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 24px;
      }

      .auction {
        background: #1e1e2e;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        transition: all 0.3s;
        border: 1px solid #2d2d44;
        border-left: 4px solid #667eea;
      }

      .auction:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      }

      .auction.ended {
        opacity: 0.7;
        border-left-color: #dc3545;
      }

      /* Chat Box */
      .chat-container {
        background: #1e1e2e;
        border-radius: 12px;
        border: 1px solid #2d2d44;
        height: 500px;
        display: flex;
        flex-direction: column;
      }

      .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .chat-message {
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 70%;
        word-wrap: break-word;
      }

      .chat-message.own {
        background: #667eea;
        align-self: flex-end;
        color: white;
      }

      .chat-message.other {
        background: #2d2d44;
        align-self: flex-start;
      }

      .chat-message.system {
        background: #1a1a2e;
        align-self: center;
        font-style: italic;
        color: #b0b3b8;
        font-size: 13px;
      }

      .chat-sender {
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 13px;
      }

      .chat-input-area {
        padding: 16px;
        border-top: 1px solid #2d2d44;
        display: flex;
        gap: 8px;
      }

      .chat-input-area input {
        flex: 1;
      }

      .chat-input-area button {
        padding: 12px 24px;
      }

      /* UDP Notifications Panel */
      .notifications-panel {
        background: #1e1e2e;
        border-radius: 12px;
        border: 1px solid #2d2d44;
        padding: 20px;
        max-height: 500px;
        overflow-y: auto;
      }

      .notification-item {
        padding: 12px 16px;
        background: #16213e;
        border-radius: 8px;
        margin-bottom: 12px;
        border-left: 4px solid #667eea;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .notification-item.alert {
        border-left-color: #ff9800;
      }

      .notification-item.warning {
        border-left-color: #dc3545;
      }

      .notification-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      .notification-icon.info {
        background: rgba(102, 126, 234, 0.2);
        color: #667eea;
      }

      .notification-icon.alert {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
      }

      .notification-icon.warning {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
      }

      /* File Upload Area */
      .file-upload-area {
        background: #1e1e2e;
        border: 2px dashed #2d2d44;
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .file-upload-area:hover {
        border-color: #667eea;
        background: #16213e;
      }

      .file-upload-area.dragover {
        border-color: #667eea;
        background: #16213e;
      }

      .file-list {
        margin-top: 20px;
      }

      .file-item {
        background: #16213e;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* Stats Panel */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: #1e1e2e;
        border-radius: 12px;
        padding: 24px;
        border: 1px solid #2d2d44;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin: 8px 0;
      }

      .stat-label {
        color: #b0b3b8;
        font-size: 14px;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        top: 24px;
        right: 24px;
        padding: 16px 20px;
        border-radius: 12px;
        color: white;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      }

      .toast.success {
        background: linear-gradient(135deg, #28a745, #20c997);
      }

      .toast.error {
        background: linear-gradient(135deg, #dc3545, #c82333);
      }

      .toast.show {
        opacity: 1;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .dashboard-header {
          flex-direction: column;
          gap: 16px;
        }

        .tabs {
          padding: 0 16px;
        }

        .tab-content {
          padding: 16px;
        }

        .auctions-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="login" style="display: block">
      <div class="login-header">
        <div class="logo-container">
          <i class="fas fa-gavel"></i>
        </div>
        <h1>BidEasy</h1>
        <p>Enterprise Auction Platform with Private Chat</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="username"><i class="fas fa-user"></i> Username</label>
          <input
            type="text"
            id="username"
            placeholder="Enter your username"
            required
          />
        </div>
        <button type="submit">
          <i class="fas fa-sign-in-alt"></i>
          Sign In to Platform
        </button>
      </form>
    </div>

    <!-- Main Dashboard -->
    <div id="main" style="display: none">
      <div class="dashboard-header">
        <div class="header-left">
          <div class="header-logo">
            <i class="fas fa-gavel"></i>
          </div>
          <div class="header-title">
            <h1>BidEasy Dashboard</h1>
            <p>
              Real-time auction platform with private chat, notifications &
              security
            </p>
          </div>
        </div>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-details">
            <strong id="currentUser"></strong>
            <div class="connection-status status-offline" id="connectionStatus">
              <span class="status-dot"></span>
              <span id="statusText">Offline</span>
            </div>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="openTab(event, 'auctionList')">
          <i class="fas fa-list"></i> Active Auctions
        </button>
        <button class="tab" onclick="openTab(event, 'createAuction')">
          <i class="fas fa-plus-circle"></i> Create Auction
        </button>
        <button class="tab" onclick="openTab(event, 'chatTab')">
          <i class="fas fa-comments"></i> Chat (NIO)
        </button>
        <button class="tab" onclick="openTab(event, 'notificationsTab')">
          <i class="fas fa-bell"></i> UDP Alerts
        </button>
        <button class="tab" onclick="openTab(event, 'myActivity')">
          <i class="fas fa-chart-line"></i> My Activity
        </button>
      </div>

      <!-- Active Auctions Tab -->
      <div id="auctionList" class="tab-content active">
        <div class="content-header">
          <h2><i class="fas fa-fire"></i> Active Auctions</h2>
        </div>
        <div id="auctions" class="auctions-grid">
          <div
            style="
              grid-column: 1/-1;
              text-align: center;
              padding: 60px;
              color: #b0b3b8;
            "
          >
            <i
              class="fas fa-inbox"
              style="font-size: 64px; margin-bottom: 16px; color: #2d2d44"
            ></i>
            <p>
              No active auctions at the moment.<br />Be the first to create one!
            </p>
          </div>
        </div>
      </div>

      <!-- Create Auction Tab -->
      <div id="createAuction" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-plus-circle"></i> Create New Auction</h2>
        </div>
        <form id="createForm">
          <div class="form-group">
            <label><i class="fas fa-tag"></i> Auction Name</label>
            <input
              type="text"
              id="name"
              placeholder="e.g., iPhone 15 Pro Max"
              required
            />
          </div>
          <div class="form-group">
            <label><i class="fas fa-dollar-sign"></i> Starting Price ($)</label>
            <input
              type="number"
              id="price"
              step="0.01"
              min="0.01"
              placeholder="100.00"
              required
            />
          </div>
          <div class="form-group">
            <label><i class="fas fa-clock"></i> Duration (seconds)</label>
            <input
              type="number"
              id="duration"
              min="10"
              placeholder="60"
              required
            />
          </div>
          <button type="submit">
            <i class="fas fa-rocket"></i>
            Launch Auction
          </button>
        </form>
      </div>

      <!-- Chat Tab (Feature 1 - NIO) -->
      <div id="chatTab" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-comments"></i> Private Chat (Java NIO)</h2>
          <span
            style="
              background: #2d2d44;
              padding: 6px 12px;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <i class="fas fa-info-circle"></i> Non-blocking I/O
          </span>
        </div>

        <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px">
          <!-- User List -->
          <div
            style="
              background: #1e1e2e;
              border-radius: 12px;
              border: 1px solid #2d2d44;
              padding: 16px;
            "
          >
            <h3 style="margin-bottom: 16px; font-size: 16px">
              <i class="fas fa-users"></i> Online Users
            </h3>
            <div
              id="userList"
              style="display: flex; flex-direction: column; gap: 8px"
            >
              <div
                style="
                  color: #b0b3b8;
                  text-align: center;
                  padding: 20px;
                  font-size: 13px;
                "
              >
                <i
                  class="fas fa-user-friends"
                  style="font-size: 32px; opacity: 0.5; margin-bottom: 8px"
                ></i>
                <p>No users online</p>
              </div>
            </div>
          </div>

          <!-- Chat Area -->
          <div class="chat-container">
            <div
              style="
                background: #16213e;
                padding: 12px 20px;
                border-bottom: 1px solid #2d2d44;
              "
            >
              <span id="chatWith" style="font-weight: 600; color: #667eea">
                <i class="fas fa-comment-dots"></i> Select a user to chat
              </span>
            </div>
            <div class="chat-messages" id="chatMessages">
              <div class="chat-message system">
                <i class="fas fa-info-circle"></i> Select a user from the list
                to start chatting
              </div>
            </div>
            <div class="chat-input-area">
              <input
                type="text"
                id="chatInput"
                placeholder="Select a user first..."
                disabled
                onkeypress="if(event.key==='Enter') sendChatMessage()"
              />
              <button
                class="action-button"
                id="sendChatBtn"
                onclick="sendChatMessage()"
                disabled
              >
                <i class="fas fa-paper-plane"></i> Send
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- UDP Notifications Tab (Feature 2) -->
      <div id="notificationsTab" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-bell"></i> UDP Broadcast Notifications</h2>
          <span
            style="
              background: #2d2d44;
              padding: 6px 12px;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <i class="fas fa-info-circle"></i> Connectionless Protocol
          </span>
        </div>
        <div class="notifications-panel" id="notificationsPanel">
          <div class="notification-item">
            <div class="notification-icon info">
              <i class="fas fa-info-circle"></i>
            </div>
            <div>
              <strong>UDP Notifications Active</strong>
              <p style="color: #b0b3b8; font-size: 13px; margin: 4px 0 0 0">
                Real-time alerts via UDP broadcasting (Member 2's feature)
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- My Activity Tab -->
      <div id="myActivity" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-chart-line"></i> My Activity</h2>
        </div>
        <div id="activityLog"></div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
      let ws;
      let username;
      let myAuctions = [];
      let myBids = [];

      // Login
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          login();
        });

      function login() {
        username = document.getElementById("username").value.trim();
        if (!username) {
          showToast("Please enter a username", "error");
          return;
        }

        try {
          ws = new WebSocket("ws://localhost:5001");

          ws.onopen = () => {
            ws.send("LOGIN|" + username);
            document.getElementById("statusText").textContent = "Connecting...";

            // Connect to NIO Chat
            connectToChat();
          };

          ws.onmessage = handleMessage;

          ws.onclose = () => {
            const statusEl = document.getElementById("connectionStatus");
            statusEl.className = "connection-status status-offline";
            document.getElementById("statusText").textContent = "Offline";
            showToast(
              "Connection lost. Please refresh and try again.",
              "error"
            );
          };

          ws.onerror = () => {
            showToast(
              "Connection error. Make sure the server is running.",
              "error"
            );
          };
        } catch (error) {
          showToast(
            "Failed to connect. Make sure the server is running on localhost:5001",
            "error"
          );
        }
      }

      function handleMessage(event) {
        const msg = event.data;
        console.log("Received:", msg);

        // Handle chat messages
        if (msg.startsWith("CHAT_")) {
          handleChatMessage(msg);
          return;
        }

        if (msg.startsWith("WELCOME|")) {
          document.getElementById("login").style.display = "none";
          document.getElementById("main").style.display = "block";
          document.getElementById("currentUser").textContent = username;
          document.getElementById("userAvatar").textContent = username
            .charAt(0)
            .toUpperCase();
          const statusEl = document.getElementById("connectionStatus");
          statusEl.className = "connection-status status-online";
          document.getElementById("statusText").textContent = "Online";
          showToast("Welcome to BidEasy!", "success");
          updateMyActivity();

          // Initialize chat after login
          setTimeout(() => connectToChat(), 500);
        } else if (msg.startsWith("NEW_AUCTION|")) {
          const parts = msg.split("|");
          addAuction(parts[1], parts[2], parts[3], parts[4]);
          addUDPNotification("NEW_AUCTION", `New auction: ${parts[2]}`, "info");
        } else if (msg.startsWith("UPDATE|")) {
          const parts = msg.split("|");
          updateAuction(parts[1], parts[2], parts[3]);
          addUDPNotification(
            "HIGH_BID",
            `${parts[3]} bid $${parts[2]} on auction #${parts[1]}`,
            "alert"
          );
        } else if (msg.startsWith("END|")) {
          const parts = msg.split("|");
          endAuction(parts[1], parts[2], parts[3]);
          addUDPNotification(
            "AUCTION_ENDED",
            `Auction #${parts[1]} ended. Winner: ${parts[2]}`,
            "warning"
          );
        } else if (msg.startsWith("ERROR|")) {
          const errorMsg = msg.split("|")[1];
          showToast("Error: " + errorMsg, "error");
        }
      }

      // Chat System (Feature 1 - NIO) - Private Messaging
      let chatSocket = null;
      let selectedChatUser = null;
      let onlineUsers = new Set();
      let chatHistory = {}; // Store chat messages per user

      function connectToChat() {
        // Use the main WebSocket connection for chat
        chatSocket = ws;

        if (chatSocket && chatSocket.readyState === WebSocket.OPEN) {
          // Request initial user list
          chatSocket.send("CHAT_GET_USERS");
          console.log("Chat initialized on main WebSocket");
        } else {
          console.error("Main WebSocket not connected");
        }
      }

      function handleChatMessage(msg) {
        if (msg.startsWith("CHAT_USERS|")) {
          const usersList = msg.split("|")[1];
          updateUserList(usersList);
        } else if (msg.startsWith("CHAT_PRIVATE|")) {
          const parts = msg.split("|");
          const sender = parts[1];
          const message = parts[2];
          receivePrivateMessage(sender, message);
        } else if (msg.startsWith("CHAT_PRIVATE_SENT|")) {
          const parts = msg.split("|");
          const recipient = parts[1];
          const message = parts[2];
          showPrivateMessageSent(recipient, message);
        } else if (msg.startsWith("CHAT_ERROR|")) {
          const errorMsg = msg.split("|")[1];
          showToast(errorMsg, "error");
        }
      }
      function updateUserList(usersString) {
        const users = usersString.split(",").filter((u) => u && u !== username);
        onlineUsers = new Set(users);

        const userListDiv = document.getElementById("userList");
        userListDiv.innerHTML = "";

        if (users.length === 0) {
          userListDiv.innerHTML = `
            <div style="color: #b0b3b8; text-align: center; padding: 20px; font-size: 13px;">
              <i class="fas fa-user-friends" style="font-size: 32px; opacity: 0.5; margin-bottom: 8px;"></i>
              <p>No other users online</p>
            </div>
          `;
          return;
        }

        users.forEach((user) => {
          const userDiv = document.createElement("div");
          userDiv.className = "user-item";
          userDiv.style.cssText = `
            padding: 12px;
            background: ${selectedChatUser === user ? "#667eea" : "#16213e"};
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
          `;

          const unreadCount =
            chatHistory[user] && chatHistory[user].unread
              ? chatHistory[user].unread
              : 0;

          userDiv.innerHTML = `
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
              ${user.charAt(0).toUpperCase()}
            </div>
            <div style="flex: 1;">
              <div style="font-weight: 600; ${
                selectedChatUser === user ? "color: white" : "color: #e4e6eb"
              }">${user}</div>
              ${
                unreadCount > 0
                  ? `<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px;">${unreadCount}</span>`
                  : ""
              }
            </div>
          `;

          userDiv.onmouseenter = () => {
            if (selectedChatUser !== user) {
              userDiv.style.background = "#1e1e2e";
            }
          };
          userDiv.onmouseleave = () => {
            if (selectedChatUser !== user) {
              userDiv.style.background = "#16213e";
            }
          };

          userDiv.onclick = () => selectUser(user);
          userListDiv.appendChild(userDiv);
        });
      }

      function selectUser(user) {
        selectedChatUser = user;
        document.getElementById(
          "chatWith"
        ).innerHTML = `<i class="fas fa-user"></i> Chatting with <strong>${user}</strong>`;
        document.getElementById("chatInput").disabled = false;
        document.getElementById("chatInput").placeholder = `Message ${user}...`;
        document.getElementById("sendChatBtn").disabled = false;

        // Mark messages as read
        if (chatHistory[user]) {
          chatHistory[user].unread = 0;
        }

        // Update user list to refresh selection
        updateUserList(Array.from(onlineUsers).join(","));

        // Load chat history for this user
        loadChatHistory(user);
      }

      function loadChatHistory(user) {
        const messagesDiv = document.getElementById("chatMessages");
        messagesDiv.innerHTML = "";

        if (!chatHistory[user] || chatHistory[user].messages.length === 0) {
          messagesDiv.innerHTML = `
            <div class="chat-message system">
              <i class="fas fa-info-circle"></i> Start chatting with ${user}
            </div>
          `;
        } else {
          chatHistory[user].messages.forEach((msg) => {
            const msgDiv = document.createElement("div");
            msgDiv.className = `chat-message ${msg.type}`;
            if (msg.type === "other") {
              msgDiv.innerHTML = `<div class="chat-sender">${msg.sender}</div>${msg.text}`;
            } else {
              msgDiv.textContent = msg.text;
            }
            messagesDiv.appendChild(msgDiv);
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
      }

      function sendChatMessage() {
        if (!selectedChatUser) {
          showToast("Please select a user first", "error");
          return;
        }

        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (message && chatSocket && chatSocket.readyState === WebSocket.OPEN) {
          // Send private message
          chatSocket.send(`CHAT_PRIVATE|${selectedChatUser}|${message}`);
          input.value = "";
        }
      }

      function receivePrivateMessage(sender, message) {
        // Store in history
        if (!chatHistory[sender]) {
          chatHistory[sender] = { messages: [], unread: 0 };
        }
        chatHistory[sender].messages.push({
          type: "other",
          sender: sender,
          text: message,
        });

        // If chatting with this user, show message
        if (selectedChatUser === sender) {
          showChatMessage("other", message, sender);
        } else {
          // Increment unread count
          chatHistory[sender].unread = (chatHistory[sender].unread || 0) + 1;
          updateUserList(Array.from(onlineUsers).join(","));
          showToast(`New message from ${sender}`, "success");
        }
      }

      function showPrivateMessageSent(recipient, message) {
        // Store in history
        if (!chatHistory[recipient]) {
          chatHistory[recipient] = { messages: [], unread: 0 };
        }
        chatHistory[recipient].messages.push({
          type: "own",
          sender: username,
          text: message,
        });

        // If chatting with this user, show message
        if (selectedChatUser === recipient) {
          showChatMessage("own", message);
        }
      }

      function showChatMessage(type, text, sender = username) {
        const messagesDiv = document.getElementById("chatMessages");
        const msgDiv = document.createElement("div");
        msgDiv.className = "chat-message " + type;

        if (type === "other") {
          msgDiv.innerHTML = `<div class="chat-sender">${sender}</div>${text}`;
        } else if (type === "own") {
          msgDiv.textContent = text;
        } else {
          msgDiv.innerHTML = `<i class="fas fa-info-circle"></i> ${text}`;
        }

        messagesDiv.appendChild(msgDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // UDP Notifications (Feature 2)
      function addUDPNotification(type, message, level) {
        const panel = document.getElementById("notificationsPanel");
        const notifDiv = document.createElement("div");
        notifDiv.className = "notification-item " + level;

        let icon = "info-circle";
        if (level === "alert") icon = "exclamation-triangle";
        if (level === "warning") icon = "exclamation-circle";

        notifDiv.innerHTML = `
          <div class="notification-icon ${level}">
            <i class="fas fa-${icon}"></i>
          </div>
          <div>
            <strong>${type.replace(/_/g, " ")}</strong>
            <p style="color: #b0b3b8; font-size: 13px; margin: 4px 0 0 0;">
              ${message}
            </p>
            <small style="color: #666; font-size: 11px;">${new Date().toLocaleTimeString()}</small>
          </div>
        `;

        panel.insertBefore(notifDiv, panel.firstChild);

        // Keep only last 20 notifications
        while (panel.children.length > 20) {
          panel.removeChild(panel.lastChild);
        }
      }

      // Auctions
      function addAuction(id, name, price, duration) {
        const auctionsDiv = document.getElementById("auctions");
        if (auctionsDiv.querySelector('[style*="grid-column"]')) {
          auctionsDiv.innerHTML = "";
        }

        const div = document.createElement("div");
        div.id = "auction-" + id;
        div.className = "auction";
        div.innerHTML = `
          <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
            <h3 style="color: #667eea;">${name}</h3>
            <span style="background: #2d2d44; padding: 4px 12px; border-radius: 8px; font-size: 12px;">ID: ${id}</span>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
            <div>
              <small style="color: #b0b3b8;">Starting Price</small>
              <div style="font-size: 18px; font-weight: bold; color: #28a745;">$${parseFloat(
                price
              ).toFixed(2)}</div>
            </div>
            <div>
              <small style="color: #b0b3b8;">Current Bid</small>
              <div style="font-size: 18px; font-weight: bold; color: #28a745;" id="current-bid-${id}">$${parseFloat(
          price
        ).toFixed(2)}</div>
            </div>
            <div>
              <small style="color: #b0b3b8;">Highest Bidder</small>
              <div id="bidder-${id}">None yet</div>
            </div>
            <div>
              <small style="color: #b0b3b8;">Time Left</small>
              <div style="color: #667eea; font-weight: bold;" id="timer-${id}">${duration}s</div>
            </div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="action-button" style="flex: 1;" id="bid-btn-10-${id}" onclick="quickBidIncrement(${id}, 10)">
              <i class="fas fa-plus"></i> Bid $${(
                parseFloat(price) + 10
              ).toFixed(2)}
            </button>
            <button class="action-button" style="flex: 1;" id="bid-btn-50-${id}" onclick="quickBidIncrement(${id}, 50)">
              <i class="fas fa-plus"></i> Bid $${(
                parseFloat(price) + 50
              ).toFixed(2)}
            </button>
          </div>
        `;
        auctionsDiv.appendChild(div);

        startTimer(id, parseInt(duration));
        showToast(`New auction: ${name}`, "success");
      }

      function updateAuction(id, bid, bidder) {
        const currentBidEl = document.getElementById(`current-bid-${id}`);
        const bidderEl = document.getElementById(`bidder-${id}`);

        if (currentBidEl)
          currentBidEl.textContent = `$${parseFloat(bid).toFixed(2)}`;
        if (bidderEl) bidderEl.textContent = bidder;

        // Update bid button labels to show new amounts
        const bidBtn10 = document.getElementById(`bid-btn-10-${id}`);
        const bidBtn50 = document.getElementById(`bid-btn-50-${id}`);

        if (bidBtn10) {
          bidBtn10.innerHTML = `<i class="fas fa-plus"></i> Bid $${(
            parseFloat(bid) + 10
          ).toFixed(2)}`;
        }
        if (bidBtn50) {
          bidBtn50.innerHTML = `<i class="fas fa-plus"></i> Bid $${(
            parseFloat(bid) + 50
          ).toFixed(2)}`;
        }

        if (bidder === username) {
          showToast(
            `You are now the highest bidder on auction ${id}!`,
            "success"
          );
        }
      }

      function endAuction(id, winner, price) {
        const div = document.getElementById("auction-" + id);
        if (div) {
          div.className = "auction ended";
          div.style.opacity = "0.6";
        }

        if (winner === username) {
          showToast(
            `ðŸ† Congratulations! You won auction ${id} with $${price}!`,
            "success"
          );
        }
      }

      function startTimer(auctionId, duration) {
        let timeLeft = duration;
        const timerElement = document.getElementById(`timer-${auctionId}`);

        const interval = setInterval(() => {
          timeLeft--;
          if (timerElement) {
            timerElement.textContent = timeLeft + "s";
            if (timeLeft <= 10) {
              timerElement.style.color = "#dc3545";
              if (timeLeft === 10) {
                addUDPNotification(
                  "ENDING_SOON",
                  `Auction #${auctionId} ending in 10 seconds!`,
                  "warning"
                );
              }
            }
          }
          if (timeLeft <= 0) {
            clearInterval(interval);
          }
        }, 1000);
      }

      function quickBid(auctionId, amount) {
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(`BID|${auctionId}|${amount}|${username}`);
          showToast(
            `Bid placed: $${amount.toFixed(2)} on auction ${auctionId}`,
            "success"
          );
          myBids.push({ id: auctionId, amount });
          updateMyActivity();
        } else {
          showToast("Connection lost. Please refresh the page.", "error");
        }
      }

      function quickBidIncrement(auctionId, increment) {
        const currentBidEl = document.getElementById(
          `current-bid-${auctionId}`
        );
        if (!currentBidEl) {
          showToast("Auction not found", "error");
          return;
        }

        // Extract current bid value
        const currentBidText = currentBidEl.textContent.replace("$", "");
        const currentBid = parseFloat(currentBidText);
        const newBid = currentBid + increment;

        quickBid(auctionId, newBid);
      }

      // Create auction
      document
        .getElementById("createForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("name").value.trim();
          const price = document.getElementById("price").value;
          const duration = document.getElementById("duration").value;

          if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(`CREATE|${name}|${price}|${duration}`);
            showToast("Auction created successfully!", "success");
            document.getElementById("createForm").reset();
            myAuctions.push({ name, price, duration });
            updateMyActivity();
          } else {
            showToast("Connection lost. Please refresh the page.", "error");
          }
        });

      // My Activity
      function updateMyActivity() {
        const activityLog = document.getElementById("activityLog");
        let html = "";

        html +=
          '<div style="background: #1e1e2e; border-radius: 12px; padding: 24px; border: 1px solid #2d2d44; margin-bottom: 20px;">';
        html +=
          '<h3 style="margin-bottom: 16px;"><i class="fas fa-plus-circle"></i> Auctions Created</h3>';
        if (myAuctions.length === 0) {
          html +=
            '<p style="color: #b0b3b8;">You haven\'t created any auctions yet.</p>';
        } else {
          myAuctions.forEach((auction) => {
            html += `
              <div style="background: #16213e; padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #667eea;">
                <strong>${auction.name}</strong><br>
                <small style="color: #b0b3b8;">Starting at $${parseFloat(
                  auction.price
                ).toFixed(2)} â€¢ Duration: ${auction.duration}s</small>
              </div>
            `;
          });
        }
        html += "</div>";

        html +=
          '<div style="background: #1e1e2e; border-radius: 12px; padding: 24px; border: 1px solid #2d2d44;">';
        html +=
          '<h3 style="margin-bottom: 16px;"><i class="fas fa-hand-holding-usd"></i> Bids Placed</h3>';
        if (myBids.length === 0) {
          html +=
            '<p style="color: #b0b3b8;">You haven\'t placed any bids yet.</p>';
        } else {
          myBids.forEach((bid) => {
            html += `
              <div style="background: #16213e; padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #ff9800;">
                <strong>Bid on Auction #${bid.id}</strong><br>
                <small style="color: #b0b3b8;">Amount: $${parseFloat(
                  bid.amount
                ).toFixed(2)}</small>
              </div>
            `;
          });
        }
        html += "</div>";

        activityLog.innerHTML = html;
      }

      // Tab navigation
      function openTab(evt, tabName) {
        const tabcontent = document.getElementsByClassName("tab-content");
        for (let i = 0; i < tabcontent.length; i++) {
          tabcontent[i].classList.remove("active");
        }
        const tabs = document.getElementsByClassName("tab");
        for (let i = 0; i < tabs.length; i++) {
          tabs[i].classList.remove("active");
        }
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
      }

      // Toast notification
      function showToast(message, type) {
        const toast = document.getElementById("toast");
        const icon = type === "success" ? "check-circle" : "exclamation-circle";
        toast.innerHTML = `<i class="fas fa-${icon}"></i><span>${message}</span>`;
        toast.className = `toast ${type} show`;

        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // Initialize
      updateMyActivity();

      // Simulate some initial UDP notifications
      setTimeout(() => {
        addUDPNotification(
          "SYSTEM",
          "UDP notification system initialized (Port 5003)",
          "info"
        );
      }, 1000);
    </script>
  </body>
</html>
