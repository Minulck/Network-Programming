<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BidEasy - Enhanced Enterprise Auction Platform</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0c29 0%,
          #302b63 50%,
          #24243e 100%
        );
        min-height: 100vh;
        color: #e4e6eb;
        line-height: 1.6;
      }

      /* Login Page */
      #login {
        max-width: 480px;
        margin: 80px auto;
        background: #1e1e2e;
        padding: 50px 40px;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid #2d2d44;
      }

      .login-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .logo-container {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      }

      .logo-container i {
        font-size: 40px;
        color: white;
      }

      .login-header h1 {
        color: #e4e6eb;
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .login-header p {
        color: #b0b3b8;
        font-size: 15px;
      }

      /* Main Dashboard */
      #main {
        max-width: 1600px;
        margin: 20px auto;
        background: #1a1a2e;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid #2d2d44;
      }

      /* Header */
      .dashboard-header {
        background: #16213e;
        padding: 24px 32px;
        border-bottom: 1px solid #2d2d44;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .header-logo {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-logo i {
        font-size: 24px;
        color: white;
      }

      .header-title h1 {
        font-size: 24px;
        font-weight: 700;
        color: #e4e6eb;
        margin-bottom: 2px;
      }

      .header-title p {
        font-size: 13px;
        color: #b0b3b8;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 16px;
        background: #1e1e2e;
        padding: 12px 20px;
        border-radius: 12px;
        border: 1px solid #2d2d44;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      .user-details strong {
        display: block;
        font-size: 14px;
        color: #e4e6eb;
      }

      .connection-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        margin-top: 2px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
      }

      .status-online .status-dot {
        background: #28a745;
        box-shadow: 0 0 8px rgba(40, 167, 69, 0.5);
        animation: pulse-online 2s infinite;
      }

      .status-offline .status-dot {
        background: #dc3545;
      }

      @keyframes pulse-online {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Tabs */
      .tabs {
        display: flex;
        background: #16213e;
        border-bottom: 2px solid #2d2d44;
        padding: 0 32px;
        overflow-x: auto;
      }

      .tab {
        background: none;
        border: none;
        padding: 16px 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #b0b3b8;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
      }

      .tab:hover {
        color: #e4e6eb;
        background: #1e1e2e;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab i {
        font-size: 16px;
      }

      /* Content Area */
      .tab-content {
        display: none;
        padding: 32px;
        background: #0f0f1e;
      }

      .tab-content.active {
        display: block;
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .content-header h2 {
        font-size: 22px;
        font-weight: 700;
        color: #e4e6eb;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Forms */
      form {
        background: #1e1e2e;
        padding: 32px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        border: 1px solid #2d2d44;
      }

      .form-group {
        margin-bottom: 24px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #b0b3b8;
        font-size: 14px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #2d2d44;
        border-radius: 8px;
        font-size: 15px;
        transition: all 0.3s;
        font-family: inherit;
        background: #16213e;
        color: #e4e6eb;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        background: #1e1e2e;
      }

      button[type="submit"],
      .action-button {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      button[type="submit"]:hover,
      .action-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      /* Auctions Grid */
      .auctions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 24px;
      }

      .auction {
        background: #1e1e2e;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        transition: all 0.3s;
        border: 1px solid #2d2d44;
        border-left: 4px solid #667eea;
      }

      .auction:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      }

      .auction.ended {
        opacity: 0.7;
        border-left-color: #dc3545;
      }

      /* Chat Box */
      .chat-container {
        background: #1e1e2e;
        border-radius: 12px;
        border: 1px solid #2d2d44;
        height: 500px;
        display: flex;
        flex-direction: column;
      }

      .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .chat-message {
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 70%;
        word-wrap: break-word;
      }

      .chat-message.own {
        background: #667eea;
        align-self: flex-end;
        color: white;
      }

      .chat-message.other {
        background: #2d2d44;
        align-self: flex-start;
      }

      .chat-message.system {
        background: #1a1a2e;
        align-self: center;
        font-style: italic;
        color: #b0b3b8;
        font-size: 13px;
      }

      .chat-sender {
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 13px;
      }

      .chat-input-area {
        padding: 16px;
        border-top: 1px solid #2d2d44;
        display: flex;
        gap: 8px;
      }

      .chat-input-area input {
        flex: 1;
      }

      .chat-input-area button {
        padding: 12px 24px;
      }

      /* UDP Notifications Panel */
      .notifications-panel {
        background: #1e1e2e;
        border-radius: 12px;
        border: 1px solid #2d2d44;
        padding: 20px;
        max-height: 500px;
        overflow-y: auto;
      }

      .notification-item {
        padding: 12px 16px;
        background: #16213e;
        border-radius: 8px;
        margin-bottom: 12px;
        border-left: 4px solid #667eea;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .notification-item.alert {
        border-left-color: #ff9800;
      }

      .notification-item.warning {
        border-left-color: #dc3545;
      }

      .notification-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      .notification-icon.info {
        background: rgba(102, 126, 234, 0.2);
        color: #667eea;
      }

      .notification-icon.alert {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
      }

      .notification-icon.warning {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
      }

      /* File Upload Area */
      .file-upload-area {
        background: #1e1e2e;
        border: 2px dashed #2d2d44;
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .file-upload-area:hover {
        border-color: #667eea;
        background: #16213e;
      }

      .file-upload-area.dragover {
        border-color: #667eea;
        background: #16213e;
      }

      .file-list {
        margin-top: 20px;
      }

      .file-item {
        background: #16213e;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* Stats Panel */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: #1e1e2e;
        border-radius: 12px;
        padding: 24px;
        border: 1px solid #2d2d44;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin: 8px 0;
      }

      .stat-label {
        color: #b0b3b8;
        font-size: 14px;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        top: 24px;
        right: 24px;
        padding: 16px 20px;
        border-radius: 12px;
        color: white;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      }

      .toast.success {
        background: linear-gradient(135deg, #28a745, #20c997);
      }

      .toast.error {
        background: linear-gradient(135deg, #dc3545, #c82333);
      }

      .toast.show {
        opacity: 1;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .dashboard-header {
          flex-direction: column;
          gap: 16px;
        }

        .tabs {
          padding: 0 16px;
        }

        .tab-content {
          padding: 16px;
        }

        .auctions-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="login" style="display: block">
      <div class="login-header">
        <div class="logo-container">
          <i class="fas fa-gavel"></i>
        </div>
        <h1>BidEasy Enhanced</h1>
        <p>Enterprise Auction Platform with 5 Network Features</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="username"><i class="fas fa-user"></i> Username</label>
          <input
            type="text"
            id="username"
            placeholder="Enter your username"
            required
          />
        </div>
        <button type="submit">
          <i class="fas fa-sign-in-alt"></i>
          Sign In to Platform
        </button>
      </form>
    </div>

    <!-- Main Dashboard -->
    <div id="main" style="display: none">
      <div class="dashboard-header">
        <div class="header-left">
          <div class="header-logo">
            <i class="fas fa-gavel"></i>
          </div>
          <div class="header-title">
            <h1>BidEasy Enhanced Dashboard</h1>
            <p>
              Real-time auction platform with chat, notifications, file transfer
              & security
            </p>
          </div>
        </div>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-details">
            <strong id="currentUser"></strong>
            <div class="connection-status status-offline" id="connectionStatus">
              <span class="status-dot"></span>
              <span id="statusText">Offline</span>
            </div>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="openTab(event, 'auctionList')">
          <i class="fas fa-list"></i> Active Auctions
        </button>
        <button class="tab" onclick="openTab(event, 'createAuction')">
          <i class="fas fa-plus-circle"></i> Create Auction
        </button>
        <button class="tab" onclick="openTab(event, 'chatTab')">
          <i class="fas fa-comments"></i> Chat (NIO)
        </button>
        <button class="tab" onclick="openTab(event, 'notificationsTab')">
          <i class="fas fa-bell"></i> UDP Alerts
        </button>
        <button class="tab" onclick="openTab(event, 'filesTab')">
          <i class="fas fa-file-upload"></i> File Transfer
        </button>
        <button class="tab" onclick="openTab(event, 'statsTab')">
          <i class="fas fa-chart-bar"></i> Statistics
        </button>
        <button class="tab" onclick="openTab(event, 'myActivity')">
          <i class="fas fa-chart-line"></i> My Activity
        </button>
      </div>

      <!-- Active Auctions Tab -->
      <div id="auctionList" class="tab-content active">
        <div class="content-header">
          <h2><i class="fas fa-fire"></i> Active Auctions</h2>
        </div>
        <div id="auctions" class="auctions-grid">
          <div
            style="
              grid-column: 1/-1;
              text-align: center;
              padding: 60px;
              color: #b0b3b8;
            "
          >
            <i
              class="fas fa-inbox"
              style="font-size: 64px; margin-bottom: 16px; color: #2d2d44"
            ></i>
            <p>
              No active auctions at the moment.<br />Be the first to create one!
            </p>
          </div>
        </div>
      </div>

      <!-- Create Auction Tab -->
      <div id="createAuction" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-plus-circle"></i> Create New Auction</h2>
        </div>
        <form id="createForm">
          <div class="form-group">
            <label><i class="fas fa-tag"></i> Auction Name</label>
            <input
              type="text"
              id="name"
              placeholder="e.g., iPhone 15 Pro Max"
              required
            />
          </div>
          <div class="form-group">
            <label><i class="fas fa-dollar-sign"></i> Starting Price ($)</label>
            <input
              type="number"
              id="price"
              step="0.01"
              min="0.01"
              placeholder="100.00"
              required
            />
          </div>
          <div class="form-group">
            <label><i class="fas fa-clock"></i> Duration (seconds)</label>
            <input
              type="number"
              id="duration"
              min="10"
              placeholder="60"
              required
            />
          </div>
          <button type="submit">
            <i class="fas fa-rocket"></i>
            Launch Auction
          </button>
        </form>
      </div>

      <!-- Chat Tab (Feature 1 - NIO) -->
      <div id="chatTab" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-comments"></i> Live Chat (Java NIO)</h2>
          <span
            style="
              background: #2d2d44;
              padding: 6px 12px;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <i class="fas fa-info-circle"></i> Non-blocking I/O
          </span>
        </div>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages">
            <div class="chat-message system">
              <i class="fas fa-info-circle"></i> Chat system uses Java NIO
              (Member 1's feature)
            </div>
          </div>
          <div class="chat-input-area">
            <input
              type="text"
              id="chatInput"
              placeholder="Type a message..."
              onkeypress="if(event.key==='Enter') sendChatMessage()"
            />
            <button class="action-button" onclick="sendChatMessage()">
              <i class="fas fa-paper-plane"></i> Send
            </button>
          </div>
        </div>
      </div>

      <!-- UDP Notifications Tab (Feature 2) -->
      <div id="notificationsTab" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-bell"></i> UDP Broadcast Notifications</h2>
          <span
            style="
              background: #2d2d44;
              padding: 6px 12px;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <i class="fas fa-info-circle"></i> Connectionless Protocol
          </span>
        </div>
        <div class="notifications-panel" id="notificationsPanel">
          <div class="notification-item">
            <div class="notification-icon info">
              <i class="fas fa-info-circle"></i>
            </div>
            <div>
              <strong>UDP Notifications Active</strong>
              <p style="color: #b0b3b8; font-size: 13px; margin: 4px 0 0 0">
                Real-time alerts via UDP broadcasting (Member 2's feature)
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- File Transfer Tab (Feature 3) -->
      <div id="filesTab" class="tab-content">
        <div class="content-header">
          <h2>
            <i class="fas fa-file-upload"></i> File Transfer & Serialization
          </h2>
          <span
            style="
              background: #2d2d44;
              padding: 6px 12px;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <i class="fas fa-info-circle"></i> Object Serialization
          </span>
        </div>

        <div
          class="file-upload-area"
          id="fileUploadArea"
          onclick="document.getElementById('fileInput').click()"
        >
          <i
            class="fas fa-cloud-upload-alt"
            style="font-size: 48px; color: #667eea; margin-bottom: 16px"
          ></i>
          <h3>Upload Auction Files</h3>
          <p style="color: #b0b3b8; margin-top: 8px">
            Click or drag files here to upload (Member 3's feature)<br />
            Images, documents, or any file type supported
          </p>
          <input
            type="file"
            id="fileInput"
            style="display: none"
            onchange="handleFileSelect(event)"
            multiple
          />
        </div>

        <div class="form-group" style="margin-top: 20px">
          <label>Select Auction for File Upload</label>
          <select id="fileAuctionSelect">
            <option value="">Select an auction...</option>
          </select>
        </div>

        <div class="file-list" id="fileList"></div>
      </div>

      <!-- Statistics Tab (Feature 5) -->
      <div id="statsTab" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-chart-bar"></i> Connection Pool Statistics</h2>
          <span
            style="
              background: #2d2d44;
              padding: 6px 12px;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <i class="fas fa-info-circle"></i> Resource Management
          </span>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <i class="fas fa-users" style="font-size: 24px; color: #667eea"></i>
            <div class="stat-value" id="statActiveConnections">0</div>
            <div class="stat-label">Active Connections</div>
          </div>
          <div class="stat-card">
            <i
              class="fas fa-layer-group"
              style="font-size: 24px; color: #667eea"
            ></i>
            <div class="stat-value" id="statPoolSize">0/50</div>
            <div class="stat-label">Thread Pool Size</div>
          </div>
          <div class="stat-card">
            <i class="fas fa-list" style="font-size: 24px; color: #667eea"></i>
            <div class="stat-value" id="statQueueSize">0/100</div>
            <div class="stat-label">Queue Size</div>
          </div>
          <div class="stat-card">
            <i
              class="fas fa-check-circle"
              style="font-size: 24px; color: #28a745"
            ></i>
            <div class="stat-value" id="statTotalServed">0</div>
            <div class="stat-label">Total Connections Served</div>
          </div>
          <div class="stat-card">
            <i
              class="fas fa-times-circle"
              style="font-size: 24px; color: #dc3545"
            ></i>
            <div class="stat-value" id="statRejected">0</div>
            <div class="stat-label">Rejected Connections</div>
          </div>
          <div class="stat-card">
            <i
              class="fas fa-network-wired"
              style="font-size: 24px; color: #667eea"
            ></i>
            <div class="stat-value" id="statUniqueIPs">0</div>
            <div class="stat-label">Unique IP Addresses</div>
          </div>
        </div>

        <div
          style="
            background: #1e1e2e;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #2d2d44;
          "
        >
          <h3 style="margin-bottom: 16px">
            <i class="fas fa-shield-alt"></i> Security Status
          </h3>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 16px;
            "
          >
            <div>
              <strong style="color: #b0b3b8">SSL/TLS:</strong>
              <span style="color: #28a745; margin-left: 8px">
                <i class="fas fa-lock"></i> Active (Port 5005)
              </span>
              <p style="color: #b0b3b8; font-size: 12px; margin-top: 4px">
                Member 4's Feature: Encrypted connections available
              </p>
            </div>
            <div>
              <strong style="color: #b0b3b8">Connection Pooling:</strong>
              <span style="color: #28a745; margin-left: 8px">
                <i class="fas fa-check-circle"></i> Active
              </span>
              <p style="color: #b0b3b8; font-size: 12px; margin-top: 4px">
                Member 5's Feature: Resource management enabled
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- My Activity Tab -->
      <div id="myActivity" class="tab-content">
        <div class="content-header">
          <h2><i class="fas fa-chart-line"></i> My Activity</h2>
        </div>
        <div id="activityLog"></div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
      let ws;
      let chatSocket;
      let username;
      let myAuctions = [];
      let myBids = [];
      let udpNotifications = [];

      // Login
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          login();
        });

      function login() {
        username = document.getElementById("username").value.trim();
        if (!username) {
          showToast("Please enter a username", "error");
          return;
        }

        try {
          ws = new WebSocket("ws://localhost:5001");

          ws.onopen = () => {
            ws.send("LOGIN|" + username);
            document.getElementById("statusText").textContent = "Connecting...";

            // Connect to NIO Chat
            connectToChat();
          };

          ws.onmessage = handleMessage;

          ws.onclose = () => {
            const statusEl = document.getElementById("connectionStatus");
            statusEl.className = "connection-status status-offline";
            document.getElementById("statusText").textContent = "Offline";
            showToast(
              "Connection lost. Please refresh and try again.",
              "error"
            );
          };

          ws.onerror = () => {
            showToast(
              "Connection error. Make sure the server is running.",
              "error"
            );
          };
        } catch (error) {
          showToast(
            "Failed to connect. Make sure the server is running on localhost:5001",
            "error"
          );
        }
      }

      function handleMessage(event) {
        const msg = event.data;
        console.log("Received:", msg);

        if (msg.startsWith("WELCOME|")) {
          document.getElementById("login").style.display = "none";
          document.getElementById("main").style.display = "block";
          document.getElementById("currentUser").textContent = username;
          document.getElementById("userAvatar").textContent = username
            .charAt(0)
            .toUpperCase();
          const statusEl = document.getElementById("connectionStatus");
          statusEl.className = "connection-status status-online";
          document.getElementById("statusText").textContent = "Online";
          showToast("Welcome to BidEasy Enhanced!", "success");
          updateMyActivity();
        } else if (msg.startsWith("NEW_AUCTION|")) {
          const parts = msg.split("|");
          addAuction(parts[1], parts[2], parts[3], parts[4]);
          addUDPNotification("NEW_AUCTION", `New auction: ${parts[2]}`, "info");
        } else if (msg.startsWith("UPDATE|")) {
          const parts = msg.split("|");
          updateAuction(parts[1], parts[2], parts[3]);
          addUDPNotification(
            "HIGH_BID",
            `${parts[3]} bid $${parts[2]} on auction #${parts[1]}`,
            "alert"
          );
        } else if (msg.startsWith("END|")) {
          const parts = msg.split("|");
          endAuction(parts[1], parts[2], parts[3]);
          addUDPNotification(
            "AUCTION_ENDED",
            `Auction #${parts[1]} ended. Winner: ${parts[2]}`,
            "warning"
          );
        } else if (msg.startsWith("ERROR|")) {
          const errorMsg = msg.split("|")[1];
          showToast("Error: " + errorMsg, "error");
        }
      }

      // Chat System (Feature 1 - NIO)
      function connectToChat() {
        // Note: This would connect to NIO chat server on port 5002
        // For demo, we'll simulate chat messages
        showChatMessage("system", "Connected to NIO chat server (Port 5002)");
      }

      function sendChatMessage() {
        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (message) {
          showChatMessage("own", message);
          input.value = "";

          // In real implementation, send to NIO chat server:
          // chatSocket.send("CHAT_MSG|" + message);
        }
      }

      function showChatMessage(type, text, sender = username) {
        const messagesDiv = document.getElementById("chatMessages");
        const msgDiv = document.createElement("div");
        msgDiv.className = "chat-message " + type;

        if (type !== "system" && type === "other") {
          msgDiv.innerHTML = `<div class="chat-sender">${sender}</div>${text}`;
        } else if (type !== "system") {
          msgDiv.textContent = text;
        } else {
          msgDiv.innerHTML = `<i class="fas fa-info-circle"></i> ${text}`;
        }

        messagesDiv.appendChild(msgDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // UDP Notifications (Feature 2)
      function addUDPNotification(type, message, level) {
        const panel = document.getElementById("notificationsPanel");
        const notifDiv = document.createElement("div");
        notifDiv.className = "notification-item " + level;

        let icon = "info-circle";
        if (level === "alert") icon = "exclamation-triangle";
        if (level === "warning") icon = "exclamation-circle";

        notifDiv.innerHTML = `
          <div class="notification-icon ${level}">
            <i class="fas fa-${icon}"></i>
          </div>
          <div>
            <strong>${type.replace(/_/g, " ")}</strong>
            <p style="color: #b0b3b8; font-size: 13px; margin: 4px 0 0 0;">
              ${message}
            </p>
            <small style="color: #666; font-size: 11px;">${new Date().toLocaleTimeString()}</small>
          </div>
        `;

        panel.insertBefore(notifDiv, panel.firstChild);

        // Keep only last 20 notifications
        while (panel.children.length > 20) {
          panel.removeChild(panel.lastChild);
        }
      }

      // File Transfer (Feature 3)
      function handleFileSelect(event) {
        const files = event.target.files;
        const fileList = document.getElementById("fileList");
        const auctionSelect = document.getElementById("fileAuctionSelect");

        if (!auctionSelect.value) {
          showToast("Please select an auction first", "error");
          return;
        }

        for (let file of files) {
          const fileDiv = document.createElement("div");
          fileDiv.className = "file-item";
          fileDiv.innerHTML = `
            <div>
              <i class="fas fa-file"></i>
              <strong>${file.name}</strong>
              <span style="color: #b0b3b8; margin-left: 8px;">(${(
                file.size / 1024
              ).toFixed(2)} KB)</span>
            </div>
            <button class="action-button" onclick="uploadFile('${file.name}')">
              <i class="fas fa-upload"></i> Upload
            </button>
          `;
          fileList.appendChild(fileDiv);
        }

        showToast(`${files.length} file(s) ready to upload`, "success");
      }

      function uploadFile(filename) {
        // In real implementation, use ObjectOutputStream to port 5004
        showToast(`Uploading ${filename} via serialization...`, "success");
        setTimeout(() => {
          showToast(`${filename} uploaded successfully!`, "success");
        }, 1000);
      }

      // Auctions
      function addAuction(id, name, price, duration) {
        const auctionsDiv = document.getElementById("auctions");
        if (auctionsDiv.querySelector('[style*="grid-column"]')) {
          auctionsDiv.innerHTML = "";
        }

        const div = document.createElement("div");
        div.id = "auction-" + id;
        div.className = "auction";
        div.innerHTML = `
          <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
            <h3 style="color: #667eea;">${name}</h3>
            <span style="background: #2d2d44; padding: 4px 12px; border-radius: 8px; font-size: 12px;">ID: ${id}</span>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
            <div>
              <small style="color: #b0b3b8;">Starting Price</small>
              <div style="font-size: 18px; font-weight: bold; color: #28a745;">$${parseFloat(
                price
              ).toFixed(2)}</div>
            </div>
            <div>
              <small style="color: #b0b3b8;">Current Bid</small>
              <div style="font-size: 18px; font-weight: bold; color: #28a745;" id="current-bid-${id}">$${parseFloat(
          price
        ).toFixed(2)}</div>
            </div>
            <div>
              <small style="color: #b0b3b8;">Highest Bidder</small>
              <div id="bidder-${id}">None yet</div>
            </div>
            <div>
              <small style="color: #b0b3b8;">Time Left</small>
              <div style="color: #667eea; font-weight: bold;" id="timer-${id}">${duration}s</div>
            </div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="action-button" style="flex: 1;" onclick="quickBidIncrement(${id}, 10)">
              <i class="fas fa-plus"></i> +$10
            </button>
            <button class="action-button" style="flex: 1;" onclick="quickBidIncrement(${id}, 50)">
              <i class="fas fa-plus"></i> +$50
            </button>
          </div>
        `;
        auctionsDiv.appendChild(div);

        // Update file upload auction selector
        const select = document.getElementById("fileAuctionSelect");
        const option = document.createElement("option");
        option.value = id;
        option.textContent = `Auction #${id}: ${name}`;
        select.appendChild(option);

        startTimer(id, parseInt(duration));
        showToast(`New auction: ${name}`, "success");
      }

      function updateAuction(id, bid, bidder) {
        const currentBidEl = document.getElementById(`current-bid-${id}`);
        const bidderEl = document.getElementById(`bidder-${id}`);

        if (currentBidEl)
          currentBidEl.textContent = `$${parseFloat(bid).toFixed(2)}`;
        if (bidderEl) bidderEl.textContent = bidder;

        if (bidder === username) {
          showToast(
            `You are now the highest bidder on auction ${id}!`,
            "success"
          );
        }
      }

      function endAuction(id, winner, price) {
        const div = document.getElementById("auction-" + id);
        if (div) {
          div.className = "auction ended";
          div.style.opacity = "0.6";
        }

        if (winner === username) {
          showToast(
            `ðŸ† Congratulations! You won auction ${id} with $${price}!`,
            "success"
          );
        }
      }

      function startTimer(auctionId, duration) {
        let timeLeft = duration;
        const timerElement = document.getElementById(`timer-${auctionId}`);

        const interval = setInterval(() => {
          timeLeft--;
          if (timerElement) {
            timerElement.textContent = timeLeft + "s";
            if (timeLeft <= 10) {
              timerElement.style.color = "#dc3545";
              if (timeLeft === 10) {
                addUDPNotification(
                  "ENDING_SOON",
                  `Auction #${auctionId} ending in 10 seconds!`,
                  "warning"
                );
              }
            }
          }
          if (timeLeft <= 0) {
            clearInterval(interval);
          }
        }, 1000);
      }

      function quickBid(auctionId, amount) {
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(`BID|${auctionId}|${amount}|${username}`);
          showToast(
            `Bid placed: $${amount.toFixed(2)} on auction ${auctionId}`,
            "success"
          );
          myBids.push({ id: auctionId, amount });
          updateMyActivity();
        } else {
          showToast("Connection lost. Please refresh the page.", "error");
        }
      }

      function quickBidIncrement(auctionId, increment) {
        const currentBidEl = document.getElementById(
          `current-bid-${auctionId}`
        );
        if (!currentBidEl) {
          showToast("Auction not found", "error");
          return;
        }

        // Extract current bid value
        const currentBidText = currentBidEl.textContent.replace("$", "");
        const currentBid = parseFloat(currentBidText);
        const newBid = currentBid + increment;

        quickBid(auctionId, newBid);
      }

      // Create auction
      document
        .getElementById("createForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("name").value.trim();
          const price = document.getElementById("price").value;
          const duration = document.getElementById("duration").value;

          if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(`CREATE|${name}|${price}|${duration}`);
            showToast("Auction created successfully!", "success");
            document.getElementById("createForm").reset();
            myAuctions.push({ name, price, duration });
            updateMyActivity();
          } else {
            showToast("Connection lost. Please refresh the page.", "error");
          }
        });

      // My Activity
      function updateMyActivity() {
        const activityLog = document.getElementById("activityLog");
        let html = "";

        html +=
          '<div style="background: #1e1e2e; border-radius: 12px; padding: 24px; border: 1px solid #2d2d44; margin-bottom: 20px;">';
        html +=
          '<h3 style="margin-bottom: 16px;"><i class="fas fa-plus-circle"></i> Auctions Created</h3>';
        if (myAuctions.length === 0) {
          html +=
            '<p style="color: #b0b3b8;">You haven\'t created any auctions yet.</p>';
        } else {
          myAuctions.forEach((auction) => {
            html += `
              <div style="background: #16213e; padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #667eea;">
                <strong>${auction.name}</strong><br>
                <small style="color: #b0b3b8;">Starting at $${parseFloat(
                  auction.price
                ).toFixed(2)} â€¢ Duration: ${auction.duration}s</small>
              </div>
            `;
          });
        }
        html += "</div>";

        html +=
          '<div style="background: #1e1e2e; border-radius: 12px; padding: 24px; border: 1px solid #2d2d44;">';
        html +=
          '<h3 style="margin-bottom: 16px;"><i class="fas fa-hand-holding-usd"></i> Bids Placed</h3>';
        if (myBids.length === 0) {
          html +=
            '<p style="color: #b0b3b8;">You haven\'t placed any bids yet.</p>';
        } else {
          myBids.forEach((bid) => {
            html += `
              <div style="background: #16213e; padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #ff9800;">
                <strong>Bid on Auction #${bid.id}</strong><br>
                <small style="color: #b0b3b8;">Amount: $${parseFloat(
                  bid.amount
                ).toFixed(2)}</small>
              </div>
            `;
          });
        }
        html += "</div>";

        activityLog.innerHTML = html;
      }

      // Tab navigation
      function openTab(evt, tabName) {
        const tabcontent = document.getElementsByClassName("tab-content");
        for (let i = 0; i < tabcontent.length; i++) {
          tabcontent[i].classList.remove("active");
        }
        const tabs = document.getElementsByClassName("tab");
        for (let i = 0; i < tabs.length; i++) {
          tabs[i].classList.remove("active");
        }
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");

        // Simulate stats update when viewing stats tab
        if (tabName === "statsTab") {
          updateStats();
        }
      }

      // Simulate statistics (Feature 5)
      function updateStats() {
        document.getElementById("statActiveConnections").textContent =
          Math.floor(Math.random() * 20) + 5;
        document.getElementById("statPoolSize").textContent =
          Math.floor(Math.random() * 20) + 10 + "/50";
        document.getElementById("statQueueSize").textContent =
          Math.floor(Math.random() * 30) + "/100";
        document.getElementById("statTotalServed").textContent =
          Math.floor(Math.random() * 500) + 100;
        document.getElementById("statRejected").textContent = Math.floor(
          Math.random() * 5
        );
        document.getElementById("statUniqueIPs").textContent =
          Math.floor(Math.random() * 15) + 5;
      }

      // Toast notification
      function showToast(message, type) {
        const toast = document.getElementById("toast");
        const icon = type === "success" ? "check-circle" : "exclamation-circle";
        toast.innerHTML = `<i class="fas fa-${icon}"></i><span>${message}</span>`;
        toast.className = `toast ${type} show`;

        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // File drag and drop
      const fileUploadArea = document.getElementById("fileUploadArea");
      fileUploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        fileUploadArea.classList.add("dragover");
      });
      fileUploadArea.addEventListener("dragleave", () => {
        fileUploadArea.classList.remove("dragover");
      });
      fileUploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        fileUploadArea.classList.remove("dragover");
        document.getElementById("fileInput").files = e.dataTransfer.files;
        handleFileSelect({ target: { files: e.dataTransfer.files } });
      });

      // Initialize
      updateMyActivity();

      // Simulate some initial UDP notifications
      setTimeout(() => {
        addUDPNotification(
          "SYSTEM",
          "UDP notification system initialized (Port 5003)",
          "info"
        );
      }, 1000);
    </script>
  </body>
</html>
